var vote=function(){var l={informModerator:-1,undoMod:0,acceptedByOwner:1,upMod:2,downMod:3,offensive:4,favorite:5,close:6,reopen:7,deletion:10,undeletion:11,spam:12};var g=imagePath+"vote-arrow-down.png";var c=imagePath+"vote-arrow-down-on.png";var y=imagePath+"vote-arrow-up.png";var x=imagePath+"vote-arrow-up-on.png";var B=imagePath+"vote-favorite-on.png";var p=imagePath+"vote-favorite-off.png";var d="View upvote and downvote totals";var n=function(){var D='<a href="/users/login?returnurl='+escape(document.location)+'">login or register</a>';$("div.vote").find("img").not(".vote-accepted").unbind("click").click(function(){v($(this),"Please "+D+" to use voting.")});A().unbind("click").click(function(){v($(this),"Please "+D+" to flag this post.")})};var C=function(D){if(!D){D="div.vote"}$(D).find("img.vote-up").unbind("click").click(function(){vote.up($(this))});$(D).find("img.vote-down").unbind("click").click(function(){vote.down($(this))});$(D).find("img.vote-favorite").unbind("click").click(function(){vote.favorite($(this))})};var j=function(D){D.parent().find("img").not(".vote-accepted").unbind("click")};var e=function(D){$.ajax({type:"GET",url:"/posts/"+D+"/votes",dataType:"json",success:w,cache:false})};var w=function(D){$.each(D,function(){var E=$("div.vote:has(input[value="+this.PostId+"])");switch(this.VoteTypeId){case l.upMod:E.find("img.vote-up").attr("src",x);break;case l.downMod:E.find("img.vote-down").attr("src",c);break;case l.favorite:E.find("img.vote-favorite").attr("src",B);E.find("div.favoritecount b").addClass("favoritecount-selected");break;default:alert("site.vote.js > highlightExistingVotes has no case for "+this.VoteTypeId);break}});votesCast=null};var s=function(){return $("div.vote img[id^='vote-accepted-']")};var f=function(){return $("div.post-menu a[id^='lock-post-']")};var A=function(){return $("div.post-menu a[id^='flag-post-']")};var o=function(){var D=new Image();D.src=x;D=new Image();D.src=c};var m=function(D){return D.attr("src")==x};var r=function(D){return D.attr("src")==B};var a=function(D){return D.attr("src")==c};var i=function(D){return D.parent().find("input").val()};var z=function(E,D){if(m(E)){E.attr("src",y)}if(a(D)){D.attr("src",g)}};var t=function(E,G){var I=E.siblings("span.vote-count-post");var F;if(I.find(".vote-count-separator").length>0){var D=parseInt(I.children(":first").text(),10);var H=Math.abs(parseInt(I.children(":last").text(),10));F=D-H;I.css("cursor","pointer").unbind("click").attr("title",d).click(function(){vote.fetchVoteCounts($(this))})}else{F=parseInt(I.text(),10)}I.text(F+G)};var u=function(F,E){j(F);var D=i(F);q(F,D,E,b)};var q=function(G,E,D,J,I){var H={fkey:fkey};if(I){for(var F in I){H[F]=I[F]}}$.ajax({type:"POST",url:"/posts/"+E+"/vote/"+D,data:H,dataType:"json",success:function(K){J(G,E,K)},error:function(){v(G,"An error has occurred - please retry your request.")}})};var b=function(E,D,F){if(F.Success){if(F.Message){h(E,F.Message)}}else{if(window.console&&window.console.firebug&&(!F.Message||F.Message.length<5)){v(E,"FireBug seems to be enabled, which can sometimes interfere with voting;<br>please refresh the page to see if your vote was processed.<br><br>If this persists, consider disabling FireBug for this site.")}else{v(E,F.Message);z(E,E);E.parent().find("span.vote-count-post").text(F.NewScore);if(F.LastVoteTypeId){k(E,F.LastVoteTypeId)}}}C(E.parent())};var k=function(G,E){var F,D;if(E==l.upMod){F="img.vote-up";D=x}else{if(E==l.downMod){F="img.vote-down";D=c}}if(F){G.parent().find(F).attr("src",D)}};var v=function(D,E){var F=$('<div class="error-notification supernovabg"><h2>'+E+"</h2>(click on this box to dismiss)</div>");F.click(function(G){$(".error-notification").fadeOut("fast",function(){$(this).remove()})});D.parent().append(F);F.fadeIn("fast")};var h=function(E,G){var H=$('<div class="error-notification supernovabg"><h2>'+G+"</h2></div>");E.parent().append(H);H.fadeIn("fast");var D=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var F=Math.max(2500,G.length*40);setTimeout(D,F)};return{init:function(D){if(typeof isRegistered!="undefined"&&isRegistered){o();if(votesCast==null){e(D)}else{w(votesCast)}C();A().unbind("click").click(function(){vote.flag($(this))})}else{n()}s().unbind("click").click(function(){vote.acceptedAnswer($(this))});var E=$("div.post-menu a[id^='close-question-']");E.unbind("click").click(function(){vote.close(E)});$("div.post-menu a[id^='delete-post-']").unbind("click").click(function(){vote.deletion($(this))})},up:function(G){var H=G.parent().find("img.vote-up");var F=G.parent().find("img.vote-down");var E=m(H);var D=a(F);var I=E?-1:(D?2:1);t(G,I);z(H,F);if(!E){H.attr("src",x)}u(G,E?l.undoMod:l.upMod)},down:function(G){var H=G.parent().find("img.vote-up");var F=G.parent().find("img.vote-down");var E=a(F);var D=m(H);var I=E?1:(D?-2:-1);t(G,I);z(H,F);if(!E){F.attr("src",c)}u(G,E?l.undoMod:l.downMod)},favorite:function(E){var F=E.parent().find("div.favoritecount b");var D=parseInt("0"+F.text().replace(/^\s+|\s+$/g,""),10);if(!r(E)){E.attr("src",B);F.addClass("favoritecount-selected").text(++D)}else{E.attr("src",p);F.removeClass("favoritecount-selected").text((D--<=0)?"":D)}E.unbind("click");q(E,i(E),l.favorite,function(G){E.click(function(){vote.favorite($(this))})})},acceptedAnswer:function(E){if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){var F=($("#"+D+"-is-owned-by-question-owner").length>0)?"Are you sure you want to accept your own answer?  You will STILL LOSE the offered rep and THIS CANNOT BE UNDONE!":"Are you sure you want to accept this answer to your bounty question - THIS CANNOT BE UNDONE!";if(!confirm(F)){return}}if(typeof isBountyQuestion!="undefined"&&isBountyQuestion&&typeof hasOpenBounty=="undefined"){v(E,"You cannot change the accepted answer on a bounty question");return}s().unbind("click");var D=E.attr("id").substring("vote-accepted-".length);q(E,D,l.acceptedByOwner,function(H,G,I){if(I.Message.indexOf(imagePath)>-1){$("img.vote-accepted").attr("src",imagePath+"vote-accepted.png");H.attr("src",I.Message);if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){hasOpenBounty=false;$("#bounty-notification").hide()}}else{v(H,I.Message)}s().click(function(){vote.acceptedAnswer($(this))})})},flag:function(F){var D=F.attr("id").substring("flag-post-".length);var L="form-flag-"+D;var J=$("#"+D+"-only-allow-inform-moderator-flagging").length>0;var M=[[l.offensive,"Offensive, Abusive, or Hate Speech",!J],[l.spam,"Spam",!J],[l.informModerator,"Requires Moderator attention",true]];var I='<div class="popup flag-menu"><h2>Please flag with care:</h2>';I+='<div class="flag-reasons"><form id="'+L+'">';for(var G=0;G<M.length;G++){if(M[G][2]){var N="flag-radio"+D+"-"+M[G][0];I+='<input type="radio" id="'+N+'" name="flag-'+D+'" value="'+M[G][0]+'">';I+='<label for="'+N+'">'+M[G][1]+"</label><br>"}}I+='<div class="flag-comment">Why are you flagging this post?<textarea name="flag-reason" cols="33" rows="4"></textarea>';I+='<br><span class="text-counter"></span></div>';I+="</form></div>";I+='<input type="button" class="flag-cancel" value="Cancel"><input type="button" class="flag-submit" value="Flag Post">';I+="</div>";var H=$(I);var E=H.find("#"+L);var K=E.find("textarea");E.find("input").click(function(){var O=E.find("div.flag-comment");var P=vote.flagIsInform(E);O.toggle(P);if(P){K.focus()}vote.flagAllowSubmit(H,K,P)});K.charCounter({min:10,max:150,setIsValid:function(){vote.flagAllowSubmit(H,K,vote.flagIsInform(E))}});H.find(".flag-submit").click(function(){if(vote.flagIsInform(E)&&!vote.flagTextValid(K)){return}vote.flagSubmit(F,D,E,K)});H.find(".flag-cancel").click(function(){vote.flagClosePopup(F)});F.parent().append(H);H.fadeIn("fast",function(){if(J){E.find("input").click().click()}})},flagIsInform:function(D){var E=D.find("input:radio:checked");if(E.length==0){return false}return E.val()==l.informModerator},flagAllowSubmit:function(E,F,G){var D=G?vote.flagTextValid(F):true;E.find(".flag-submit").toggle(D)},flagTextValid:function(E){var D=E.val().length;return(D>=10&&D<=150)},flagClosePopup:function(D){D.parent().find(".popup").fadeOut("fast",function(){$(this).remove()})},flagSubmit:function(G,E,D,H){vote.flagClosePopup(G);var F=D.find("input:radio:checked").val();var E=G.attr("id").substring("flag-post-".length);if(F==l.informModerator){$.ajax({type:"POST",url:"/messages/inform-moderator-about-post/"+E,dataType:"json",data:{fkey:fkey,msg:H.val()},success:function(I){showAjaxError(G.parent(),I.Message)},error:function(I,K,J){showAjaxError(G.parent(),(I.responseText&&I.responseText.length<100?I.responseText:"An error occurred during submission"))}})}else{q(G,E,F,vote.flagSubmitCallback,{comment:H.val()})}},flagSubmitCallback:function(E,D,G){if(G&&G.Success){if(G.Message){}}else{var F=E.parent();if(G&&G.Message){showAjaxError(F,G.Message)}else{showAjaxError(F,"A problem occurred during flagging")}}},close:function(E){var F=E.text().indexOf("open")>-1;var D=E.attr("id").substring("close-question-".length);if(F){if(confirm("Nominate this question for reopening?")){q(E,D,l.reopen,vote.close_result)}}else{if(!vote.close_reasons){vote.close_fetchReasons(E,D)}else{vote.close_renderForm(E)}}},close_reasons:null,close_votesRemainingToday:0,close_whenCanVote:"",close_hasVoted:false,close_fetchReasons:function(E,D){$(".error-notification").fadeOutAndRemove();appendLoader(E);$.ajax({type:"GET",url:"/posts/close-reasons/"+D,dataType:"json",success:function(F){removeLoader();vote.close_hasVoted=F.hasVoted;vote.close_votesRemainingToday=F.closeVotesRemainingToday;vote.close_whenCanVote=F.whenCanVote;vote.close_reasons=F.reasons;vote.close_renderForm(E)},error:function(F,H,G){removeLoader();showAjaxError(E.parent(),(F.responseText&&F.responseText.length<100?F.responseText:"An error occurred while fetching close reasons"))}})},close_renderForm:function(H){var F=H.attr("id").substring("close-question-".length);var D="close-popup-"+F;var M="form-close-"+F;var N=!vote.close_hasVoted&&vote.close_votesRemainingToday>0;$("#"+D).remove();var K='<div id="'+D+'" class="popup" style="width:710px"><h2 style="margin-bottom:12px;">'+(vote.close_hasVoted?"You have already voted to close this question":vote.close_votesRemainingToday==0?"You have no more close votes today; come back "+vote.close_whenCanVote:"Why should this question be closed?")+'</h2><ul class="close-reasons">';for(var I=0;I<vote.close_reasons.length;I++){var L=vote.close_reasons[I];var G="close-reason-"+L.id;var E=N?'<input type="radio" id="'+G+'" name="close-'+F+'" value="'+L.id+'">':"";K+="<li><table><tr><td>"+E+'</td><td><label for="'+G+'" class="cp"><span class="close-reason">'+L.name+"</span>"+(L.count>0?' <span class="bounty-indicator-tab" style="margin-left:3px; line-height:20px;" title="this many votes already exist">'+L.count+"</span>":"")+'</label></td></tr><tr><td></td><td class="close-desc">'+L.description+"</td></tr></table></li>"}K+='</ul><input type="button" class="close-cancel" value="Cancel">';if(N){K+='<table class="close-submit-container"><tbody><tr><td><span class="bounty-indicator-tab">'+vote.close_votesRemainingToday+"</span> vote"+(vote.close_votesRemainingToday==1?"":"s")+' remaining</td><td><input type="button" class="close-submit" value="Vote to Close" disabled="disabled"></td></tr></tbody></table>'}K+="</div>";var J=$(K);J.find('input[type="radio"]').click(function(){J.find(".close-submit").removeAttr("disabled").css("cursor","pointer")});J.find(".close-submit").click(function(){vote.close_reasonClick(H,J,F)});J.find(".close-cancel").click(function(){J.fadeOutAndRemove()});J.find("td.close-desc").click(function(){$(this).closest("li").find("input").click()});if(!N){J.find("td, label").css("cursor","auto")}H.parent().append(J);J.fadeIn("fast")},close_reasonExactDuplicateId:1,close_hasLinkedDuplicateQuestions:false,close_reasonClick:function(E,F,D){var G=F.find('input[type="radio"]:checked').val();if(G==vote.close_reasonExactDuplicateId){vote.close_duplicateForm(E,F,D)}else{F.fadeOutAndRemove();appendLoader(E);q(E,D,l.close,vote.close_result,{"close-reason-id":G})}},close_duplicateForm:function(G,I,E){var H=I.find(".close-submit");H.unbind("click").attr("disabled","disabled").css("cursor","default");I.find("h2, ul").remove();I.css("width","490px");var J="duplicate-question-"+E;var F='<div style="padding-bottom:18px"><h2>This question is a duplicate of which other question?</h2><input id="'+J+'" type="text" size="78" style="width:480px"><br><span class="close-duplicate-prompt">Type a question id or title to search for valid targets</span><div class="existing-linked-questions"></div></div>';var D=$(F);D.find("#"+J).autocomplete("/search/duplicate-questions/"+E,{highlightItem:true,matchContains:true,matchSubset:false,scroll:true,scrollHeight:300,formatItem:function(K){H.attr("disabled","disabled").css("cursor","default");var M=K[0];var L=K[1];return(M=="-1")?('<b style="color:#990000">'+L+"</b>"):(M+" - "+L)},formatResult:function(K){var L=K[0];return(L=="-1")?" ":L}}).result(function(L,K){if(K&&K[0]!="-1"){H.removeAttr("disabled","disabled").css("cursor","pointer")}});I.prepend(D);vote.close_showExistingDuplicates(I,E);I.find("#"+J).focus();H.click(function(){I.fadeOutAndRemove();q(G,E,l.close,vote.close_result,{"close-reason-id":vote.close_reasonExactDuplicateId,"duplicate-question-id":$("#"+J).val()})})},close_showExistingDuplicates:function(I,D){var H=false;for(var F=0;F<vote.close_reasons.length;F++){var G=vote.close_reasons[F];if(G.id==vote.close_reasonExactDuplicateId){if(G.count>0){H=true}break}}if(!H){return}var E=I.find("div.existing-linked-questions");appendLoader(E);E.append("<p>Other users chose these questions as the master question:</p>");$.getJSON("/posts/existing-close-duplicate-questions/"+D,function(K){removeLoader();for(var J=0;J<K.length;J++){E.append('<li><a href="'+K[J].url+'" target="_blank">'+K[J].title+"</a></li>")}})},close_result:function(E,D,G){removeLoader();if(G&&G.Success){if(G.Message){var H=E.text().indexOf("open")>-1;E.text(E.text().replace(/\w?\(\d\)/,"")+" "+G.Message);v(E,"This question still needs "+G.NewScore+" vote(s) from other users to "+(H?"reopen":"close"))}else{location.reload(true)}vote.close_reasons=null}else{var F=E.parent();if(G&&G.Message){showAjaxError(F,G.Message)}else{showAjaxError(F,"A problem occurred during closing/reopening")}}},deletion:function(F){var D=F.attr("id").substring("delete-post-".length);var E=F.text().indexOf("undelete")>-1;if(confirm("Vote to "+(E?"un":"")+"delete this post?")){q(F,D,(E?l.undeletion:l.deletion),vote.deletionCallback)}},deletionCallback:function(G,F,H){var I=G.text().indexOf("undelete")>-1;if(H&&H.Success){G.text(H.Message);if(H.NewScore<0){var E=$("#question:has(a[id='delete-post-"+F+"'])").length>0;var D=E?"#question, div.answer":"#answer-"+F;vote.setDeleteStyles($(D),!I)}else{v(G,"This post still needs "+H.NewScore+" vote(s) from other users to "+(I?"un":"")+"delete")}}else{var J=(H&&H.Message)?H.Message:"A problem occurred during "+(I?"un":"")+"deletion";showAjaxError(G.parent(),J)}},setDeleteStyles:function(E,D){if(D){$("div.question-status:has(span:contains('delete'))").show();E.addClass("deleted-answer").find("a[id^='delete-post-']").addClass("deleted-post").end().find("div[id^='comments-']").addClass("comments-container-deleted").end().find("a[id^='comments-link-']").addClass("comments-link-deleted")}else{document.location.reload(true)}},bountyStart:function(E){var D=$("#question div.vote input:first").val();$.post("/posts/"+D+"/bounty-start",{fkey:fkey,amount:E},function(F){if(F.Success){location.reload(true)}else{v($("#bounty-errors"),F.Message);$("#bounty-submit").attr("disabled","")}},"json")},bindFetchVoteCounts:function(){$(".vote-count-post").attr("title",d).css("cursor","pointer").unbind("click").click(function(){vote.fetchVoteCounts($(this))})},fetchVoteCounts:function(E){var D=E.closest("div.vote").children('input[type="hidden"]').val();appendLoader(E);$.ajax({type:"GET",url:"/posts/"+D+"/vote-counts",dataType:"json",success:function(G){$(".error-notification").fadeOut("fast",function(){$(this).remove()});var F='<div style="color:green">'+G.up+'</div><div class="vote-count-separator"></div><div style="color:maroon">'+G.down+"</div>";E.html(F).unbind("click").css("cursor","default").attr("title",(G.up+" up / "+G.down+" down"))},error:function(F,H,G){removeLoader();showAjaxError(E.parent(),(F.responseText&&F.responseText.length<100?F.responseText:"An error occurred during vote count fetch"))}})}}}();var comments=function(){var b=imagePath+"comment-flag.png";var m=imagePath+"comment-flag-hover.png";var c=imagePath+"comment-up.png";var h=imagePath+"comment-up-hover.png";var u=imagePath+"comment-del.png";var a=imagePath+"comment-del-hover.png";var g=600;var s=function(w,x){return $("div#comments-"+w+(x||""))};var p=function(w){appendLoader(s(w))};var e=function(){$("a[id^='comments-link-']").unbind("click").click(function(){var w=$(this).attr("id").substr("comments-link-".length);var z=s(w);f(w);z.removeClass("dno");if($(this).text().indexOf("more comment")>-1){j(w,z)}else{var y=200+($('form[id^="add-comment-"] > table').length*2);var x=z.find("tfoot form textarea");x.attr("tabindex",y++);z.find("tfoot form input").attr("tabindex",y);if(!x.closest("form").hasClass(".comment-form-expanded")){x.focus()}}$(this).remove()})};var l=function(){$("img.comment-up").click(function(){n($(this),2,c,h,function(x,w){x.closest("tr").siblings("tr").remove();x.parent().siblings().children().remove();x.parent().siblings().append(i(w.NewScore))})}).hover(function(){$(this).attr("src",h)},function(){$(this).attr("src",c)});$("img.comment-flag").click(function(){if(confirm("Really flag this comment as noise, offensive or spam?")){n($(this),4,b,m,function(x,w){if(w.NewScore==-1){x.parents("tr.comment").remove()}else{x.parents("tr.comment").find("img.comment-up").remove();x.remove()}})}}).hover(function(){$(this).attr("src",m)},function(){$(this).attr("src",b)});$("div.comments a.comment-edit").click(function(){r($(this))});$("img.comment-delete").click(function(){if(confirm("Really delete this comment?")){n($(this),10,u,a,function(x,w){x.parents("tr.comment").remove()})}}).hover(function(){$(this).attr("src",a)},function(){$(this).attr("src",u)});$("tr.comment").hover(function(){$(this).find("img.comment-up, img.comment-flag, img.comment-delete, a.comment-edit-hide").css("visibility","visible").closest("tr.comment").addClass("comment-hover")},function(){$(this).removeClass("comment-hover").find("img.comment-up, img.comment-flag, img.comment-delete, a.comment-edit-hide").css("visibility","hidden")})};var k=function(){$("tr.comment").unbind("mouseenter mouseleave");$("img.comment-up, img.comment-flag, img.comment-delete, div.comments a.comment-edit").unbind("click mouseenter mouseleave")};var j=function(w,x){p(w);$.ajax({type:"GET",url:"/posts/"+w+"/comments",dataType:"html",success:function(y){q(w,y)},error:function(y,A,z){removeLoader();showAjaxError(s(w),(y.responseText&&y.responseText.length<100?y.responseText:"An error has occured while fetching comments"))}})};var q=function(w,y){var x=s(w," > table > tbody");if(x.children().length>0){x.children().remove()}x.append(y);k();l();removeLoader()};var i=function(y){var w="";if(y&&y>0){var x=y<5?"":y<=15?"warm":y<=30?"hot":"supernova";w+='<span title="number of \'great comment\' votes received" class="'+x+'">'+y+"</span>"}return w};var o=function(w,z,x,C){var y='<table><tr><td><textarea name="comment" cols="68" rows="3"></textarea></td><td><input type="submit" value="'+z+'"/>'+(x?'<a class="edit-comment-cancel">cancel</a>':"")+'</td></tr><tr><td colspan="2"><span class="text-counter"></span><span class="form-error"></span></td></tr></table>';w.append(y);if(x){w.find(".edit-comment-cancel").click(function(){d($(this))})}var A=false;var B=function(D){A=D};w.find("textarea").charCounter({min:15,max:600,setIsValid:B});w.submit(function(){if(A){disableSubmitButton(w);C(w)}else{w.find("span.text-counter").animate({opacity:0},100,function(){$(this).animate({opacity:1},100)})}return false})};var f=function(w){o($("#add-comment-"+w),"Add Comment",false,t)};var t=function(x){var w=x.attr("id").substr("add-comment-".length);p(w);var y=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var z=x.find("textarea");var A=z.val();if(!A||$.trim(A)==""){return}$.ajax({type:"POST",url:"/posts/"+w+"/comments",dataType:"html",data:{comment:A,fkey:fkey},success:function(B){y();q(w,B);z.val("").keyup();enableSubmitButton(x)},error:function(B,D,C){removeLoader();y();showAjaxError(x,(B.responseText&&B.responseText.length<100?B.responseText:"An error occurred during comment submission"));enableSubmitButton(x)}})};var r=function(z){var y=z.closest("tr.comment");var w=y.find('form[id^="edit-comment-"]');y.find("td.comment-actions *").hide();y.find("td.comment-text > div").hide();y.find("td:last").addClass("comment-form");o(w,"Save Edits",true,v);var x=w.find("textarea");x.val(w.find("div").text());w.show();x.focus()};var v=function(x){appendLoader(x.parent());var z=x.attr("id").substr("edit-comment-".length);var w=x.closest("div.comments").attr("id").substr("comments-".length);var y=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var A=x.find("textarea");var B=A.val();if(!B||$.trim(B)==""){return}$.ajax({type:"POST",url:"/posts/comments/"+z+"/edit",dataType:"html",data:{comment:B,fkey:fkey},success:function(C){y();q(w,C)},error:function(C,E,D){removeLoader();y();showAjaxError(x,(C.responseText&&C.responseText.length<100?C.responseText:"An error occurred during comment submission"));enableSubmitButton(x)}})};var d=function(y){var x=y.closest("tr.comment");var w=x.find('form[id^="edit-comment-"]');w.children("table").remove();w.hide();x.find("td:last").removeClass("comment-form");x.find("td.comment-actions *").show();x.find("td.comment-text > div").show()};var n=function(D,z,C,A,y){var B=D.parents("tr.comment").attr("id").substr("comment-".length);var x=D.attr("class");$("div.error-notification").hide();D.removeClass().unbind("click mouseenter mouseleave").attr("src",A);appendLoader(D.parent());var w=function(){D.addClass(x).click(function(){n(D,z,C,A,y)}).attr("src",C)};$.ajax({type:"POST",url:"/posts/comments/"+B+"/vote/"+z,dataType:"json",data:{fkey:fkey},success:function(E){if(E.Success){y(D,E)}else{showAjaxError(D.parent(),E.Message);w()}},error:function(E,G,F){showAjaxError(D.parent(),(E.responseText&&E.responseText.length<100?E.responseText:"An error occurred during voting"));w()}});removeLoader()};return{init:function(){e();l();$("form.comment-form-expanded").closest("div.comments").siblings("a.comments-link").click()}}}();$.fn.selectRange=function(b,a){return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,a)}else{if(this.createTextRange){var c=this.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",b);c.select()}}})};function editorReady(b,a){$.get("/questions/ticks",function(c){$("#edit-block").append("<input type='hidden' name='i1l' value='"+c+"' />")});if($("#show-editor-button").length==0&&$("#wmd-preview").length!=0){initPostEditor(b,a)}}function initPostEditor(e,c){var b=$("#post-form");var a=$("#wmd-input");var d=$("#title, #tagnames, #edit-comment, #m-address");b.submit(function(){var f=true;var g=function(h){f=h};$(".edit-field-overlayed").removeClass(".edit-field-overlayed").val("");if(f){disableSubmitButton(b);setConfirmUnload(null)}return f});$("#original-question").not(".processed").TextAreaResizer();a.not(".processed").TextAreaResizer();a.typeWatch({highlight:false,wait:5000,captureLength:5,callback:styleCode});Attacklab.wmdBase();Attacklab.Util.startEditor();if(e){heartbeat.heartbeatNamespace=c;a.keypress(heartbeat.start)}d.blur(function(){var f=$(this).parent().find("span.edit-field-overlay");if(f.length>0){setOverlay(f)}}).keydown(clearOverlay).bind("contextmenu",clearOverlay);$("span.edit-field-overlay").each(function(){setOverlay($(this))});a.keypress(initNavPrevention);$("#wmd-preview").click(function(){a.focus()});if($("#ask-error-container").length==0){$("#title").selectRange(0,0)}d.focus(function(){if($(this).hasClass("edit-field-overlayed")){$(this).selectRange(0,0)}})}var setOverlay=function(a){var b=a.parent().find('input[type="text"]');if(b.val().length==0||b.val()==a.text()){b.val(a.text()).addClass("edit-field-overlayed")}};var invalidElements=function(){var b=[];var a=function(c){return c.attr("name")};return{add:function(e){var c=a(e);var f=true;for(var d=0;d<b.length;d++){if(b[d]==c){f=false;break}}if(f){b.push(c)}},remove:function(e){var c=a(e);for(var d=0;d<b.length;d++){if(b[d]==c){b.splice(d,1)}}},any:function(){return b.length>0}}}();function clearOverlay(){if($(this).val()==$(this).siblings("span.edit-field-overlay").html()){$(this).val("");if($(this).hasClass("edit-field-overlayed")){$(this).removeClass("edit-field-overlayed").val("")}}}function initNavPrevention(a){if(a.which=="undefined"){return}var b=$("#wmd-input");b.unbind("keypress",initNavPrevention);setConfirmUnload("You have started writing or editing a post.",b)}var heartbeat=function(){var d=1000*45;var b;var e=0;var a=false;var c=0;return{heartbeatNamespace:null,start:function(f){if(f.which=="undefined"){return}if(e++>0){return}$("#wmd-input").unbind("keypress",heartbeat.start);heartbeat.heartbeatNamespace.init();setTimeout(heartbeat.heartbeatNamespace.ping,d)},answers:function(){return{name:"heartbeat.answers",init:function(){b=location.href.match(/\/questions\/(\d+)/i)[1]},ping:function(){var f="";$("div.answer").each(function(){f+=this.id.substring("answer-".length)+" "});$.post("/posts/"+b+"/answer-activity-heartbeat",{answerIds:f},heartbeat.answers.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.NoPosting){var h="This question has been "+g.Msg+" - no more answers will be accepted.";notify.show(h);a=true;disableSubmitButton("#post-form");setConfirmUnload(null);f=false}else{if(g.Result){var h=g.Count+" new answer"+(g.Count==1?" has":"s have")+" been posted - ";h+='<a onclick="heartbeat.answers.update()">load new answers.</a>';notify.show(h);a=true}}}if(f){setTimeout(heartbeat.answers.ping,d)}},update:function(){var f=[];$.get("/questions/"+b,function(i){var l=$(i);l.find("div.answer").each(function(){var m=this.id.substring("answer-".length);if($("#answer-"+m).length==0){f.push(this.id)}});if(f.length>0){var h="#"+f.join(",#");var k=l.find(h);var g=$("div.answer:last");if(g.length==0){g=$("#answers-header")}k.hide();g.after(k);k.fadeIn("slow");var j=$("div.answer").length;$("#subheader h2").text(j+" Answer"+(j>1?"s":""));vote.init(b);comments.init()}notify.close();a=false},"html")}}}(),edits:function(){return{name:"heartbeat.edits",init:function(){b=$("#post-id").val()},ping:function(){$.post("/posts/"+b+"/edit-activity-heartbeat",{currentRevisionGuid:$("#current-revision-guid").val()},heartbeat.edits.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.message){if($("#notify-table td.notify").text()!=g.message){notify.close();notify.show(g.message)}setConfirmUnload(null);if(!g.success){disableSubmitButton("#post-form");f=false}}}if(f){setTimeout(heartbeat.edits.ping,d)}},update:function(){}}}()}}();(function(a){a.fn.typeWatch=function(d){var b=a.extend({wait:750,callback:function(){},highlight:true,captureLength:2},d);function c(h,g){var f=a(h.el).val();if((f.length>b.captureLength&&f.toUpperCase()!=h.text)||(g&&f.length>b.captureLength)){h.text=f.toUpperCase();h.cb(f)}}function e(g){if(g.type.toUpperCase()=="TEXT"||g.nodeName.toUpperCase()=="TEXTAREA"){var h={timer:null,text:a(g).val().toUpperCase(),cb:b.callback,el:g,wait:b.wait};if(b.highlight){a(g).focus(function(){this.select()})}var f=function(i){var l=h.wait;var k=false;if(i.keyCode==13&&this.type.toUpperCase()=="TEXT"){l=1;k=true}var j=function(){c(h,k)};clearTimeout(h.timer);h.timer=setTimeout(j,l)};a(g).keydown(f)}}return this.each(function(f){e(this)})}})(jQuery);(function(c){var h,i;var d=0;var a=32;var e;c.fn.TextAreaResizer=function(){return this.each(function(){h=c(this).addClass("processed"),i=null;c(this).parent().append(c('<div class="grippie"></div>').bind("mousedown",{el:this},b));var k=c("div.grippie",c(this).parent())[0];k.style.marginRight=(k.offsetWidth-c(this)[0].offsetWidth)+"px"})};function b(k){h=c(k.data.el);h.blur();d=j(k).y;i=h.height()-d;h.css("opacity",0.25);c(document).mousemove(g).mouseup(f);return false}function g(m){var k=j(m).y;var l=i+k;if(d>=(k)){l-=5}d=k;l=Math.max(a,l);h.height(l+"px");if(l<a){f(m)}return false}function f(k){c(document).unbind("mousemove",g).unbind("mouseup",f);h.css("opacity",1);h.focus();h=null;i=null;d=0}function j(k){return{x:k.clientX+document.documentElement.scrollLeft,y:k.clientY+document.documentElement.scrollTop}}})(jQuery);